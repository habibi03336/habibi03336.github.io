---

title: layer and layer mask

date: 2022-2-28 

categories:
    - etc
tags:
    - TIL


---

유니티에서는 32개의 layer를 설정할 수 있다. 그리고 layer mask를 통해 특정 layer에 있는 오브젝트만을 렌더링 하거나, 선택적으로 Raycast, 특정 layer 오브젝트끼리만 collision이 일어나게 할 수 있다. 

unity에서는 기본적으로 layer를 총 32개까지 설정할 수 있다. 왜 하필 32개 일까? 이는 layer와 layer mask가 작동하는 방식과 연관이 있다.

layer 값은 int형이다. C# 언어에서 int는 32bit이다. 0 혹은 1로써 표시되는 칸 32개로 값을 표현한다는 것이다. int타입은 2진수로 32자리까지 값을 저장할 수 있다. C#에서 int number = 17 이라는 문을 작성하면, 17은 다음과 같이 평가되어 메모리에 저장이 될 것이다.
> 0000 0000 0000 0000 0000 0000 0001 0001

유니티에서 기본적으로 제공하는 layer가 32개인 이유는, 각 레이어가 32개 자리중 1이 있는 한 칸으로 표현되기 때문이다. 예를 들어   
1번  레이어  
> 0000 0000 0000 0000 0000 0000 0000 0001

2번  레이어  
> 0000 0000 0000 0000 0000 0000 0000 0010  

7번  레이어  
> 0000 0000 0000 0000 0000 0000 0100 0000 

19번  레이어  
> 0000 0000 0000 0100 0000 0000 0000 0000

이런 식이다.   

모든 이진법으로 나타낼 수 있는 모든 경우의수를 바탕으로 layer를 만든다면 2^32개의 layer를 만들 수 있을 텐데 왜 이렇게 하는 것일까? 그것은 layer mask를 효율적으로 사용하기 위해서이다.

이와 같이 layer에 값을 부여하면, layer mask와의 한 번의 연산으로 원하는 layer를 뽑아낼 수 있다. 예를 들어 17번 레이어가 있다고 해보자.
> 0000 0000 0000 0001 0000 0000 0000 0000

그리고 1,5,7,9,12,17번 레이어에 있는 오브젝트만 렌더링의 대상이라고 하자. 그렇다면 이에 대응하는 레이어 마스크를 만들 수 있다.
> 0000 0000 0000 0001 0000 1001 0101 0001

랜더링 시 레이어 마스크와 17번 레이어 값에 대해서 AND 비트 연산을 하면 
> 0000 0000 0000 0001 0000 0000 0000 0000

이 나오게 되고, 이는 bool값으로 본다면 true 값이 된다. 이와 같은 방식으로 빠르게 해당 레이어가 대상이 되는 레이어인지 계산해 낼 수 있다. 즉 어떤 레이어 집합에 특정 레이어가 속하는지 그렇지 않은지 매우 빠르게 계산해 낼 수 있는 것이다. 레이어 마스크를 하나씩 조회한다면 레이어 개수 만큼 O(N) 시간이 필요하겠지만 이와 같은 방식으로 하면 O(1)만이 필요하기 때문이다.

layer가 32개 정도만 있다면 사실 하나씩 조회하는 것도 크게 오래걸리는 작업은 아니겠지만 게임 특성상 관련 처리를 매우 많이 해야하기 때문에 이와 같은 방식을 쓰는 것 같다.